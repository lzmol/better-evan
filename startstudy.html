<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Â≠¶‰π†ÊâìÂç° | È¶ñÈ°µ</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'ÂæÆËΩØÈõÖÈªë', sans-serif; }
        body { background: #0f172a; min-height: 100vh; display: flex; flex-direction: column; justify-content: center; align-items: center; color: #fff; transition: all 0.5s ease; overflow: hidden; }
        .screensaver { width: 100%; height: 100vh; display: flex; flex-direction: column; justify-content: center; align-items: center; position: relative; }
        .screensaver-bg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; opacity: 0.8; z-index: 0; transition: opacity 1s ease; }
        .time-wrap { position: relative; z-index: 1; text-align: center; }
        .time { font-size: 6rem; font-weight: 700; letter-spacing: 2px; text-shadow: 0 0 20px rgba(0,0,0,0.5); transition: all 0.3s ease; }
        .date { font-size: 1.8rem; margin-top: 15px; opacity: 0.9; letter-spacing: 1px; text-shadow: 0 0 10px rgba(0,0,0,0.3); }
        .enter-btn { position: absolute; bottom: 80px; z-index: 1; padding: 1.2rem 3rem; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.3); border-radius: 50px; font-size: 1.2rem; color: #fff; cursor: pointer; transition: all 0.3s ease; backdrop-filter: blur(5px); }
        .enter-btn:hover { background: rgba(255,255,255,0.2); transform: translateY(-3px); box-shadow: 0 8px 15px rgba(0,0,0,0.2); }
        .timeline-wrap { position: absolute; bottom: 200px; width: 90%; z-index: 1; background: rgba(255,255,255,0.05); backdrop-filter: blur(8px); border-radius: 12px; padding: 20px; max-height: 200px; overflow-y: auto; }
        .timeline-title { font-size: 1.2rem; margin-bottom: 15px; opacity: 0.8; text-align: left; }
        .timeline-container { position: relative; }
        .timeline { position: relative; height: 50px; background: rgba(255,255,255,0.05); border-radius: 8px; overflow: hidden; margin-bottom: 8px; cursor: pointer; }
        .timeline-marker { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; align-items: center; padding: 0 10px; pointer-events: none; }
        .timeline-marker span { flex: 1; text-align: center; font-size: 0.8rem; opacity: 0.4; color: #fff; }
        .schedule-item { position: absolute; top: 50%; transform: translateY(-50%); height: 80%; border-radius: 6px; cursor: grab; user-select: none; display: flex; align-items: center; justify-content: center; font-size: 0.9rem; font-weight: 500; color: #fff; text-shadow: 0 0 5px rgba(0,0,0,0.2); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding: 0 8px; }
        .schedule-item:active { cursor: grabbing; }
        .current-time-line { position: absolute; top: 0; width: 2px; height: 100%; background: #f87171; box-shadow: 0 0 8px rgba(248,113,113,0.8); z-index: 5; pointer-events: none; transition: left 1s linear; }
        .add-schedule-btn { position: absolute; bottom: 150px; right: 5%; z-index: 1; width: 40px; height: 40px; border-radius: 50%; background: #34d399; border: none; color: #fff; font-size: 1.5rem; cursor: pointer; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 10px rgba(52,211,153,0.3); transition: all 0.3s ease; }
        .add-schedule-btn:hover { transform: scale(1.1); box-shadow: 0 6px 15px rgba(52,211,153,0.4); }
        .container { width: 100%; height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; z-index: 1; padding: 20px; display: none; }
        .container-bg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; opacity: 0.8; z-index: -1; }
        .card { width: 100%; max-width: 500px; background: rgba(255,255,255,0.05); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; padding: 40px 30px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        .back-btn { position: absolute; top: 30px; left: 30px; width: 40px; height: 40px; border-radius: 50%; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.3); color: #fff; font-size: 1.2rem; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.3s ease; z-index: 10; }
        .back-btn:hover { background: rgba(255,255,255,0.2); }
        .motto-box { height: 80px; margin-bottom: 30px; display: flex; align-items: center; justify-content: center; }
        .motto { font-size: 1.4rem; color: #e0e7ff; font-weight: 500; opacity: 0.9; line-height: 1.5; }
        .score-box { color: #ffd700; font-size: 1.8rem; margin-bottom: 40px; font-weight: 600; text-shadow: 0 0 8px rgba(255,215,0,0.4); }
        .stopwatch { font-size: 7rem; font-weight: bold; color: #ffffff; margin: 20px 0; letter-spacing: 2px; text-shadow: 0 0 15px rgba(0,0,0,0.3); transition: all 0.3s ease; }
        .btn-group { display: flex; flex-direction: column; gap: 15px; margin-top: 30px; }
        .btn { padding: 16px; border: none; border-radius: 12px; font-size: 1.2rem; cursor: pointer; transition: all 0.3s cubic-bezier(0.34,1.56,0.64,1); font-weight: 500; background: rgba(255,255,255,0.1); color: #fff; border: 1px solid rgba(255,255,255,0.2); }
        .btn:hover { background: rgba(255,255,255,0.2); transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .btn.start { background: rgba(96,165,250,0.2); border-color: rgba(96,165,250,0.4); }
        .btn.pause { background: rgba(252,211,77,0.2); border-color: rgba(252,211,77,0.4); color: #fff; }
        .btn.reset { background: rgba(248,113,113,0.2); border-color: rgba(248,113,113,0.4); }
        .btn.complete { background: rgba(52,211,153,0.2); border-color: rgba(52,211,153,0.4); }
        .scene-area { height: 80px; margin-top: 20px; border-radius: 12px; background: rgba(255,255,255,0.03); display: flex; align-items: center; justify-content: center; font-size: 1rem; opacity: 0.7; }
        .encourage { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0); opacity: 0; transition: all 0.6s cubic-bezier(0.34,1.56,0.64,1); font-size: 3.2rem; font-weight: 700; color: #fff; text-shadow: 0 0 20px rgba(0,0,0,0.3); z-index: 100; font-family: 'Microsoft YaHei UI', 'Arial Rounded MT Bold', sans-serif; }
        .encourage.show { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        body.dim .screensaver, body.dim .container { opacity: 0.3; filter: brightness(0.5); transition: all 0.3s ease; }
        body.dim .encourage { z-index: 101; }
        .schedule-modal { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(15,23,42,0.95); backdrop-filter: blur(10px); border-radius: 15px; padding: 25px; width: 85%; max-width: 400px; z-index: 20; display: none; border: 1px solid rgba(255,255,255,0.1); }
        .modal-title { font-size: 1.4rem; margin-bottom: 20px; text-align: center; color: #fff; }
        .modal-input { width: 100%; padding: 12px 15px; margin-bottom: 15px; border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; background: rgba(255,255,255,0.05); color: #fff; font-size: 1rem; }
        .modal-input::placeholder { color: rgba(255,255,255,0.4); }
        .time-select { display: flex; gap: 10px; margin-bottom: 20px; }
        .time-select select { flex: 1; padding: 12px 15px; border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; background: rgba(255,255,255,0.05); color: #fff; font-size: 1rem; }
        .time-select select option { background: #0f172a; color: #fff; }
        .modal-btn-group { display: flex; gap: 10px; }
        .modal-btn { flex: 1; padding: 12px; border: none; border-radius: 8px; font-size: 1rem; cursor: pointer; transition: all 0.3s ease; }
        .cancel-btn { background: rgba(255,255,255,0.1); color: #fff; border: 1px solid rgba(255,255,255,0.2); }
        .confirm-btn { background: rgba(52,211,153,0.2); color: #fff; border: 1px solid rgba(52,211,153,0.4); }
        .delete-btn { background: rgba(248,113,113,0.2); color: #fff; border: 1px solid rgba(248,113,113,0.4); margin-left: 10px; }
        .mask { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 15; display: none; backdrop-filter: blur(2px); }
        .timeline-wrap::-webkit-scrollbar { width: 6px; }
        .timeline-wrap::-webkit-scrollbar-track { background: rgba(255,255,255,0.03); border-radius: 3px; }
        .timeline-wrap::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); border-radius: 3px; }
    </style>
</head>
<body>
    <div class="screensaver" id="screensaver">
        <img src="https://picsum.photos/id/1000/1920/1080" alt="ÁæéÊôØ" class="screensaver-bg" id="screensaverBg">
        <div class="time-wrap">
            <div class="time" id="currentTime">00:00:00</div>
            <div class="date" id="currentDate">2025Âπ¥12Êúà7Êó• ÊòüÊúüÊó•</div>
        </div>
        <div class="timeline-wrap">
            <div class="timeline-title">‰ªäÊó•Êó•Á®ã</div>
            <div class="timeline-container" id="timelineContainer">
                <div class="timeline">
                    <div class="timeline-marker">
                        <span>6:00</span><span>8:00</span><span>10:00</span><span>12:00</span><span>14:00</span><span>16:00</span><span>18:00</span><span>20:00</span><span>22:00</span>
                    </div>
                    <div class="current-time-line" id="currentTimeLine"></div>
                </div>
            </div>
        </div>
        <button class="add-schedule-btn" id="addScheduleBtn">+</button>
        <button class="enter-btn" id="enterBtn">ËøõÂÖ•Â≠¶‰π†ÊâìÂç°</button>
    </div>
    <div class="container" id="studyContainer">
        <img src="https://picsum.photos/id/1001/1920/1080" alt="ËÉåÊôØ" class="container-bg">
        <button class="back-btn" id="backBtn">‚Üê</button>
        <div class="card">
            <div class="motto-box">
                <div class="motto" id="motto">Âäü‰∏çÂîêÊçêÔºåÁéâÊ±ù‰∫éÊàê</div>
            </div>
            <div class="score-box">ÊÄªÁßØÂàÜÔºö<span id="totalScore">0</span></div>
            <div class="stopwatch" id="stopwatch">00:00:00</div>
            <div class="btn-group">
                <button class="btn start" id="startBtn">ÂºÄÂßãÂ≠¶‰π†</button>
                <button class="btn pause" id="pauseBtn" disabled>ÊöÇÂÅúÂ≠¶‰π†</button>
                <button class="btn reset" id="resetBtn">ÈáçÁΩÆËÆ°Êó∂</button>
                <button class="btn complete" id="completeBtn" disabled>ÂÆåÊàêÊâìÂç°</button>
            </div>
            <div class="scene-area" id="sceneArea">‰ªäÊó•Â≠¶‰π†Êó∂ÈïøÔºö0ÂàÜÈíü</div>
        </div>
    </div>
    <div class="encourage" id="encourageText"></div>
    <div class="mask" id="mask"></div>
    <div class="schedule-modal" id="scheduleModal">
        <div class="modal-title" id="modalTitle">Ê∑ªÂä†Êó•Á®ã</div>
        <input type="text" class="modal-input" id="scheduleName" placeholder="ËæìÂÖ•Êó•Á®ãÂêçÁß∞ÔºàÂ¶ÇÔºöËØ≠ÊñáÂ≠¶‰π†Ôºâ">
        <div class="time-select">
            <select id="startHour">
                <option value="6">6ÁÇπ</option><option value="7">7ÁÇπ</option><option value="8">8ÁÇπ</option><option value="9">9ÁÇπ</option><option value="10">10ÁÇπ</option><option value="11">11ÁÇπ</option><option value="12">12ÁÇπ</option><option value="13">13ÁÇπ</option><option value="14">14ÁÇπ</option><option value="15">15ÁÇπ</option><option value="16">16ÁÇπ</option><option value="17">17ÁÇπ</option><option value="18">18ÁÇπ</option><option value="19">19ÁÇπ</option><option value="20">20ÁÇπ</option><option value="21">21ÁÇπ</option><option value="22">22ÁÇπ</option>
            </select>
            <select id="endHour">
                <option value="7">7ÁÇπ</option><option value="8">8ÁÇπ</option><option value="9">9ÁÇπ</option><option value="10">10ÁÇπ</option><option value="11">11ÁÇπ</option><option value="12">12ÁÇπ</option><option value="13">13ÁÇπ</option><option value="14">14ÁÇπ</option><option value="15">15ÁÇπ</option><option value="16">16ÁÇπ</option><option value="17">17ÁÇπ</option><option value="18">18ÁÇπ</option><option value="19">19ÁÇπ</option><option value="20">20ÁÇπ</option><option value="21">21ÁÇπ</option><option value="22">22ÁÇπ</option><option value="23">23ÁÇπ</option>
            </select>
        </div>
        <div class="modal-btn-group">
            <button class="modal-btn cancel-btn" id="cancelBtn">ÂèñÊ∂à</button>
            <button class="modal-btn confirm-btn" id="confirmBtn">Á°ÆËÆ§</button>
            <button class="modal-btn delete-btn" id="deleteBtn" style="display:none">Âà†Èô§</button>
        </div>
    </div>

    <script>
        const screensaver = document.getElementById('screensaver');
        const studyContainer = document.getElementById('studyContainer');
        const enterBtn = document.getElementById('enterBtn');
        const backBtn = document.getElementById('backBtn');
        const currentTimeEl = document.getElementById('currentTime');
        const currentDateEl = document.getElementById('currentDate');
        const stopwatch = document.getElementById('stopwatch');
        const startBtn = document.getElementById('startBtn');
        const pauseBtn = document.getElementById('pauseBtn');
        const resetBtn = document.getElementById('resetBtn');
        const completeBtn = document.getElementById('completeBtn');
        const encourageText = document.getElementById('encourageText');
        const mottoEl = document.getElementById('motto');
        const bodyEl = document.body;
        const totalScoreEl = document.getElementById('totalScore');
        const screensaverBg = document.getElementById('screensaverBg');
        const timelineContainer = document.getElementById('timelineContainer');
        const addScheduleBtn = document.getElementById('addScheduleBtn');
        const scheduleModal = document.getElementById('scheduleModal');
        const mask = document.getElementById('mask');
        const scheduleName = document.getElementById('scheduleName');
        const startHour = document.getElementById('startHour');
        const endHour = document.getElementById('endHour');
        const cancelBtn = document.getElementById('cancelBtn');
        const confirmBtn = document.getElementById('confirmBtn');
        const deleteBtn = document.getElementById('deleteBtn');
        const modalTitle = document.getElementById('modalTitle');
        const currentTimeLine = document.getElementById('currentTimeLine');
        const sceneArea = document.getElementById('sceneArea');

        const mottoList = [
            "Âäü‰∏çÂîêÊçêÔºåÁéâÊ±ù‰∫éÊàê",
            "Â∞ëÂπ¥‰∏çÊÉßÂ≤ÅÊúàÈïøÔºåÂΩºÊñπÂ∞öÊúâËç£ÂÖâÂú®",
            "‰ªäÊó•‰∏çËÇØÂüãÂ§¥ÔºåÊòéÊó•‰Ωï‰ª•Êä¨Â§¥",
            "ÊòüÂÖâ‰∏çË¥üËµ∂Ë∑Ø‰∫∫ÔºåÊó∂ÂÖâ‰∏çË¥üÊúâÂøÉ‰∫∫",
            "ÂøÉÊúâÁπÅËä±Ôºå‰ΩïÊÉßË∑ØÈïø",
            "ÊÖ¢ÊÖ¢Êù•ÔºåË∞Å‰∏çÊòØÁøªÂ±±Ë∂äÂ≤≠ÂéªÊàêÈïø",
            "ÊØè‰∏Ä‰ªΩÂùöÊåÅÔºåÈÉΩÂ∞ÜÊúâÂõûÂìç",
            "Ëá™ÂæãËÄÖÊñπÂæóËá™Áî±ÔºåÁ¨ÉË°åËÄÖÁªà‰ºöÂèëÂÖâ",
            "ÈÅìÈòª‰∏îÈïøÔºåË°åÂàôÂ∞ÜËá≥ÔºõË°åËÄå‰∏çËæçÔºåÊú™Êù•ÂèØÊúü",
            "‰∏çË¥üÈü∂ÂçéÔºå‰∏çË¥üËá™Â∑±Ôºå‰∏çË¥üÁÉ≠Áà±",
            "ÂçÉÊ∑ò‰∏áÊºâËôΩËæõËã¶ÔºåÂêπÂ∞ΩÁãÇÊ≤ôÂßãÂà∞Èáë",
            "Âá°ÊâÄËøáÂæÄÔºåÁöÜ‰∏∫Â∫èÁ´†ÔºõÂá°ÊâÄÂ∞ÜÊù•ÔºåÁöÜ‰∏∫ÂèØÁõº",
            "‰ª•Ê∏∫Â∞èÂêØÁ®ãÔºå‰ª•‰ºüÂ§ßÁªìÂ∞æ",
            "Êó•Êó•Ë°åÔºå‰∏çÊÄïÂçÉ‰∏áÈáåÔºõÂ∏∏Â∏∏ÂÅöÔºå‰∏çÊÄïÂçÉ‰∏á‰∫ã",
            "Ë∂äÂä™ÂäõÔºåË∂äÂπ∏ËøêÔºõË∂äËá™ÂæãÔºåË∂äËá™Áî±",
            "‰πæÂù§Êú™ÂÆöÔºå‰Ω†ÊàëÁöÜÊòØÈªëÈ©¨",
            "‰∏çÂøòÂàùÂøÉÔºåÊñπÂæóÂßãÁªà",
            "ÂøÉÊúâÊâÄÂêëÔºåÁ¥†Â±•‰ª•ÂæÄ",
            "Ëâ∞ÈöæÊñπÊòæÂãáÊØÖÔºåÁ£®Á†∫ÂßãÂæóÁéâÊàê",
            "Áü•‰∏çË∂≥ËÄåÂ•ãËøõÔºåÊúõÂ±±ËøúËÄåÂäõË°å"
        ];
        const encourageMap = {
            0: "Â≠¶‰π†ÂºÄÂßãÂï¶ÔºåÂÖ®Âäõ‰ª•Ëµ¥ÔºÅ",
            300: "Âä†Ê≤πÔºåÂ≠¶‰∫Ü‰∫îÂàÜÈíüÂï¶ÔºÅ",
            600: "‰∏ìÊ≥®Ë∂ÖËµûÔºåÁªßÁª≠Á®≥‰ΩèÔΩû",
            900: "ÁÇπÊª¥ÁßØÁ¥ØÔºåÁªàÊàêÂ§ßÂô®",
            1200: "Ë∂äÂùöÊåÅË∂ä‰ªéÂÆπÔºåË∂ÖÊ£íÔºÅ",
            1500: "Â∑≤ÁªèÂ≠¶‰∫ÜÂ•Ω‰πÖ‰∫ÜÔºå‰ºëÊÅØ‰∏Ä‰∏ãÂêß"
        };
        const timeTipsMap = {
            5: "Êô®ÂÖâÊ≠£Â•ΩÔºåÂºÄÂêØÂÖÉÊ∞î‰∏ÄÂ§©‚ú®",
            12: "Ê≠£ÂçàÊó∂ÂÖâÔºåÂä≥ÈÄ∏ÁªìÂêàÊïàÁéáÈ´ò‚òÄÔ∏è",
            17: "Â§ïÈò≥Ë•ø‰∏ãÔºåÂùöÊåÅÂ∞±ÊòØËÉúÂà©üåÜ",
            19: "Â§úÂπïÈôç‰∏¥ÔºåÈùôÂøÉÊ≤âÊ∑ÄÊàêÈïøüåô",
            23: "Ê∑±Â§úÈùôË∞ßÔºåÈÄÇÂ∫¶Â≠¶‰π†Êó©ÁÇπ‰ºëÊÅØüåå"
        };
        const weekList = ['ÊòüÊúüÊó•', 'ÊòüÊúü‰∏Ä', 'ÊòüÊúü‰∫å', 'ÊòüÊúü‰∏â', 'ÊòüÊúüÂõõ', 'ÊòüÊúü‰∫î', 'ÊòüÊúüÂÖ≠'];
        const bgImgs = [
            'https://picsum.photos/id/1000/1920/1080',
            'https://picsum.photos/id/1001/1920/1080',
            'https://picsum.photos/id/1002/1920/1080',
            'https://picsum.photos/id/1003/1920/1080',
            'https://picsum.photos/id/1004/1920/1080',
            'https://picsum.photos/id/1005/1920/1080',
            'https://picsum.photos/id/1006/1920/1080',
            'https://picsum.photos/id/1007/1920/1080',
            'https://picsum.photos/id/1008/1920/1080',
            'https://picsum.photos/id/1009/1920/1080',
            'https://picsum.photos/id/1010/1920/1080'
        ];
        const colors = ['#60a5fa', '#34d399', '#fcd34d', '#f87171', '#a78bfa', '#fb7185', '#6ee7b7', '#fbbf24', '#818cf8', '#ec4899'];

        let seconds = 0;
        let timer = null;
        let isRunning = false;
        let showedTimes = new Set();
        let currentMottoIdx = 0;
        let mottoTimer = null;
        let timeTipTimer = null;
        let lastHour = -1;
        let dimTimer = null;
        let totalScore = localStorage.getItem('studyScore') ? parseInt(localStorage.getItem('studyScore')) : 0;
        let screensaverTimer = null;
        let bgIndex = 0;
        let schedules = JSON.parse(localStorage.getItem('studySchedules')) || [];
        let isDragging = false;
        let dragItem = null;
        let startX = 0;
        let startLeft = 0;
        let editIndex = -1;

        totalScoreEl.textContent = totalScore;
        updateStudyTime();

        function updateScreensaverTime() {
            const now = new Date();
            const h = now.getHours().toString().padStart(2, '0');
            const m = now.getMinutes().toString().padStart(2, '0');
            const s = now.getSeconds().toString().padStart(2, '0');
            currentTimeEl.textContent = `${h}:${m}:${s}`;
            
            const year = now.getFullYear();
            const month = now.getMonth() + 1;
            const day = now.getDate();
            const week = weekList[now.getDay()];
            currentDateEl.textContent = `${year}Âπ¥${month}Êúà${day}Êó• ${week}`;
            
            updateCurrentTimeLine();
        }

        function changeBgImg() {
            screensaverBg.style.opacity = 0;
            setTimeout(() => {
                bgIndex = (bgIndex + 1) % bgImgs.length;
                screensaverBg.src = bgImgs[bgIndex];
                screensaverBg.style.opacity = 0.8;
            }, 1000);
        }

        function updateCurrentTimeLine() {
            const now = new Date();
            const hour = now.getHours();
            const minute = now.getMinutes();
            const second = now.getSeconds();
            const totalSeconds = hour * 3600 + minute * 60 + second;
            const daySeconds = 23 * 3600 + 59 * 60 + 59;
            const percent = (totalSeconds / daySeconds) * 100;
            currentTimeLine.style.left = `${percent}%`;
        }

        function createTimelineRow() {
            const timeline = document.createElement('div');
            timeline.className = 'timeline';
            timeline.innerHTML = '<div class="timeline-marker"><span>6:00</span><span>8:00</span><span>10:00</span><span>12:00</span><span>14:00</span><span>16:00</span><span>18:00</span><span>20:00</span><span>22:00</span></div>';
            timelineContainer.appendChild(timeline);
            return timeline;
        }

        function renderSchedules() {
            timelineContainer.innerHTML = '<div class="timeline"><div class="timeline-marker"><span>6:00</span><span>8:00</span><span>10:00</span><span>12:00</span><span>14:00</span><span>16:00</span><span>18:00</span><span>20:00</span><span>22:00</span></div><div class="current-time-line" id="currentTimeLine"></div></div>';
            
            const rows = [timelineContainer.firstChild];
            while (rows.length < schedules.length) {
                rows.push(createTimelineRow());
            }

            schedules.forEach((item, idx) => {
                const { name, start, end, color } = item;
                const width = ((end - start) / 16) * 100;
                const left = (((start - 6) / 16) * 100);
                const itemEl = document.createElement('div');
                itemEl.className = 'schedule-item';
                itemEl.textContent = name;
                itemEl.style.width = `${width}%`;
                itemEl.style.left = `${left}%`;
                itemEl.style.background = color;
                itemEl.dataset.index = idx;

                itemEl.addEventListener('mousedown', startDrag);
                itemEl.addEventListener('touchstart', startDrag, { passive: true });
                itemEl.addEventListener('dblclick', () => editSchedule(idx));
                rows[idx].appendChild(itemEl);
            });

            document.addEventListener('mousemove', drag);
            document.addEventListener('touchmove', drag, { passive: true });
            document.addEventListener('mouseup', endDrag);
            document.addEventListener('touchend', endDrag);
        }

        function startDrag(e) {
            isDragging = true;
            dragItem = this;
            startX = e.type === 'mousedown' ? e.clientX : e.touches[0].clientX;
            startLeft = parseFloat(dragItem.style.left);
            dragItem.style.zIndex = 10;
        }

        function drag(e) {
            if (!isDragging || !dragItem) return;
            const x = e.type === 'mousemove' ? e.clientX : e.touches[0].clientX;
            const diffX = x - startX;
            const timelineWidth = dragItem.parentElement.offsetWidth;
            const perCent = (diffX / timelineWidth) * 100;
            let newLeft = startLeft + perCent;
            newLeft = Math.max(0, Math.min(100 - parseFloat(dragItem.style.width), newLeft));
            dragItem.style.left = `${newLeft}%`;

            const idx = dragItem.dataset.index;
            const hourPerCent = 16 / 100;
            const newStart = Math.round(6 + (newLeft * hourPerCent));
            const newEnd = newStart + (parseFloat(dragItem.style.width) * hourPerCent);
            schedules[idx].start = newStart;
            schedules[idx].end = Math.round(newEnd);
            localStorage.setItem('studySchedules', JSON.stringify(schedules));
        }

        function endDrag() {
            isDragging = false;
            if (dragItem) dragItem.style.zIndex = '';
            dragItem = null;
        }

        function addSchedule() {
            modalTitle.textContent = 'Ê∑ªÂä†Êó•Á®ã';
            deleteBtn.style.display = 'none';
            scheduleName.value = '';
            startHour.value = '8';
            endHour.value = '9';
            editIndex = -1;
            scheduleModal.style.display = 'block';
            mask.style.display = 'block';
        }

        function editSchedule(idx) {
            const item = schedules[idx];
            modalTitle.textContent = 'ÁºñËæëÊó•Á®ã';
            deleteBtn.style.display = 'block';
            scheduleName.value = item.name;
            startHour.value = item.start;
            endHour.value = item.end;
            editIndex = idx;
            scheduleModal.style.display = 'block';
            mask.style.display = 'block';
        }

        function saveSchedule() {
            const name = scheduleName.value.trim();
            const start = parseInt(startHour.value);
            const end = parseInt(endHour.value);
            if (!name || start >= end) return;

            if (editIndex === -1) {
                const color = colors[Math.floor(Math.random() * colors.length)];
                schedules.push({ name, start, end, color });
            } else {
                schedules[editIndex].name = name;
                schedules[editIndex].start = start;
                schedules[editIndex].end = end;
            }

            localStorage.setItem('studySchedules', JSON.stringify(schedules));
            renderSchedules();
            scheduleModal.style.display = 'none';
            mask.style.display = 'none';
        }

        function deleteSchedule() {
            if (editIndex === -1) return;
            schedules.splice(editIndex, 1);
            localStorage.setItem('studySchedules', JSON.stringify(schedules));
            renderSchedules();
            scheduleModal.style.display = 'none';
            mask.style.display = 'none';
        }

        function formatTime(sec) {
            const h = Math.floor(sec / 3600).toString().padStart(2, '0');
            const m = Math.floor((sec % 3600) / 60).toString().padStart(2, '0');
            const s = (sec % 60).toString().padStart(2, '0');
            return `${h}:${m}:${s}`;
        }

        function switchMotto() {
            currentMottoIdx = (currentMottoIdx + 1) % mottoList.length;
            mottoEl.textContent = mottoList[currentMottoIdx];
        }

        function showTips(text) {
            clearTimeout(dimTimer);
            bodyEl.classList.add('dim');
            encourageText.textContent = text;
            encourageText.classList.add('show');
            dimTimer = setTimeout(() => {
                bodyEl.classList.remove('dim');
                encourageText.classList.remove('show');
            }, 3000);
        }

        function updateTimer() {
            seconds++;
            stopwatch.textContent = formatTime(seconds);
            updateStudyTime();
            const targetSec = seconds % 1500;
            if (encourageMap[targetSec] && !showedTimes.has(targetSec)) {
                showTips(encourageMap[targetSec]);
                showedTimes.add(targetSec);
                if (targetSec === 1500) showedTimes.clear();
            }
        }

        function updateStudyTime() {
            const minutes = Math.floor(seconds / 60);
            sceneArea.textContent = `‰ªäÊó•Â≠¶‰π†Êó∂ÈïøÔºö${minutes}ÂàÜÈíü`;
        }

        function checkTimeTip() {
            const hour = new Date().getHours();
            if (hour !== lastHour && timeTipsMap[hour]) {
                showTips(timeTipsMap[hour]);
                lastHour = hour;
            }
        }

        function calculateScore() {
            const minutes = Math.floor(seconds / 60);
            let addScore = Math.floor(minutes * 1.2);
            addScore = addScore < 1 ? 1 : addScore;
            totalScore += addScore;
            localStorage.setItem('studyScore', totalScore);
            totalScoreEl.textContent = totalScore;
            showTips(`Â≠¶‰π†ÂÆåÊàêÔºÅËé∑Âæó${addScore}ÁßØÂàÜÔºåÊÄªÁßØÂàÜ${totalScore}`);
        }

        enterBtn.addEventListener('click', () => {
            screensaver.style.display = 'none';
            studyContainer.style.display = 'flex';
            mottoTimer = setInterval(switchMotto, 30000);
            timeTipTimer = setInterval(checkTimeTip, 60000);
            checkTimeTip();
            clearInterval(screensaverTimer);
        });

        backBtn.addEventListener('click', () => {
            studyContainer.style.display = 'none';
            screensaver.style.display = 'flex';
            clearInterval(mottoTimer);
            clearInterval(timeTipTimer);
            screensaverTimer = setInterval(changeBgImg, 60000);
        });

        startBtn.addEventListener('click', () => {
            if (!isRunning) {
                timer = setInterval(updateTimer, 1000);
                isRunning = true;
                startBtn.disabled = true;
                pauseBtn.disabled = false;
                completeBtn.disabled = false;
                showTips(encourageMap[0]);
            }
        });

        pauseBtn.addEventListener('click', () => {
            clearInterval(timer);
            isRunning = false;
            startBtn.disabled = false;
            pauseBtn.disabled = true;
        });

        resetBtn.addEventListener('click', () => {
            clearInterval(timer);
            isRunning = false;
            seconds = 0;
            showedTimes.clear();
            stopwatch.textContent = '00:00:00';
            updateStudyTime();
            startBtn.disabled = false;
            pauseBtn.disabled = true;
            completeBtn.disabled = true;
        });

        completeBtn.addEventListener('click', () => {
            clearInterval(timer);
            isRunning = false;
            calculateScore();
            seconds = 0;
            showedTimes.clear();
            stopwatch.textContent = '00:00:00';
            updateStudyTime();
            startBtn.disabled = false;
            pauseBtn.disabled = true;
            completeBtn.disabled = true;
        });

        addScheduleBtn.addEventListener('click', addSchedule);

        cancelBtn.addEventListener('click', () => {
            scheduleModal.style.display = 'none';
            mask.style.display = 'none';
        });

        confirmBtn.addEventListener('click', saveSchedule);

        deleteBtn.addEventListener('click', deleteSchedule);

        updateScreensaverTime();
        setInterval(updateScreensaverTime, 1000);
        screensaverTimer = setInterval(changeBgImg, 60000);
        renderSchedules();

        window.addEventListener('beforeunload', () => {
            clearInterval(timer);
            clearInterval(mottoTimer);
            clearInterval(timeTipTimer);
            clearTimeout(dimTimer);
            clearInterval(screensaverTimer);
        });
    </script>
</body>
</html>